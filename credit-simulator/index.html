<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Credit Band Payment Simulator</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <div class="container">
    <a href="../" class="back-link">&larr; Back to Tools</a>

    <header class="mb-lg">
      <h1>Credit Band Payment Simulator</h1>
    </header>

    <div class="info-box mb-lg">
      <strong>Payment Policy:</strong>
      <code>payment = max(pct(balance) * balance, minPayment(balance))</code>, then capped so you never overpay.
    </div>

    <div class="card card--muted">
      <h3 class="mb-md mt-0">Inputs</h3>

      <div class="input-row">
        <div class="input-group">
          <label for="startingBalance">Starting Balance ($)</label>
          <input id="startingBalance" type="number" step="0.01" value="5000">
        </div>
        <div class="input-group">
          <label for="apr">APR (e.g. 0.2499 = 24.99%)</label>
          <input id="apr" type="number" step="0.0001" value="0.24">
        </div>
      </div>

      <div class="input-row">
        <div class="input-group">
          <label for="months">Months to simulate</label>
          <input id="months" type="number" step="1" value="24">
        </div>
        <div class="input-group" id="simpleChargesContainer">
          <label for="monthlyCharges">Monthly Charges ($, optional)</label>
          <input id="monthlyCharges" type="number" step="0.01" value="0">
        </div>
      </div>

      <div class="toggle-container">
        <label class="toggle-switch">
          <input type="checkbox" id="advancedModeToggle">
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">LEGENDARY Mode: Specify charges per month</span>
      </div>

      <div id="monthlyChargesSection" class="section section--hidden">
        <div class="card mt-md">
          <div class="section-header">
            <h4>Monthly Charges Schedule</h4>
            <button id="fillAllChargesBtn" class="btn btn--secondary btn--sm">Fill All</button>
          </div>
          <p class="text-small text-muted mt-sm">Enter different charge amounts for each month</p>
          <div id="monthlyChargesGrid" class="scrollable-grid"></div>
        </div>
      </div>

      <div class="btn-group mt-lg">
        <button id="runBtn" class="btn">Run Simulation</button>
        <button id="addBandBtn" class="btn btn--secondary">+ Add Band</button>
        <button id="resetBtn" class="btn btn--danger">Reset Example</button>
        <button id="downloadCsvBtn" class="btn btn--secondary">Download CSV</button>
      </div>

      <div class="btn-group mt-md">
        <button id="exportConfigBtn" class="btn btn--secondary">Export Config</button>
        <button id="importConfigBtn" class="btn btn--secondary">Import Config</button>
        <input type="file" id="importFileInput" accept=".json" style="display: none;">
      </div>

      <div class="mt-md">
        <span id="status" class="status"></span>
      </div>

      <h3 class="mt-xl mb-sm">Payment Bands</h3>
      <p class="text-small text-muted mb-md">
        Rows are matched by "largest lower bound &le; current balance". Keep lower bounds ascending.
      </p>

      <div style="overflow-x: auto;">
        <table id="bandsTable">
          <thead>
            <tr>
              <th>Lower Bound ($)</th>
              <th>Pct of Balance</th>
              <th>Min Payment ($)</th>
              <th class="text-right">Remove</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="grid grid--2 mt-lg">
      <div class="card card--muted">
        <h3 class="mb-md mt-0">Balance Over Time</h3>
        <canvas id="balanceChart" height="260"></canvas>
        <p id="chartNote" class="chart-note"></p>
      </div>
      <div class="card card--muted">
        <h3 class="mb-md mt-0">Payment Over Time</h3>
        <canvas id="paymentChart" height="260"></canvas>
        <p class="chart-note">Monthly payment amounts over the simulation period</p>
      </div>
    </div>

    <div class="grid grid--2 mt-lg">
      <div class="card card--muted">
        <h3 class="mb-md mt-0">Payment vs Balance</h3>
        <canvas id="paymentVsBalanceChart" height="260"></canvas>
        <p class="chart-note">Shows how payment amount changes relative to current balance (scatter plot)</p>
      </div>
      <div class="card card--muted">
        <h3 class="mb-md mt-0">Payment Band Schedule</h3>
        <canvas id="bandChart" height="260"></canvas>
        <p class="chart-note">Theoretical payment amounts across balance ranges based on your bands</p>
      </div>
    </div>

    <div class="card mt-lg">
      <h3 class="mb-md mt-0">Monthly Results</h3>
      <div style="overflow-x: auto;">
        <table id="resultsTable">
          <thead>
            <tr>
              <th>Month</th>
              <th>Start Balance</th>
              <th>Interest</th>
              <th>Charges</th>
              <th>Payment</th>
              <th>End Balance</th>
              <th>Pct Used</th>
              <th>Min Payment</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Core modules (pure logic - no DOM dependencies) -->
  <script src="js/core/formatters.js"></script>
  <script src="js/core/bands-logic.js"></script>
  <script src="js/core/simulation.js"></script>

  <!-- UI modules (DOM-dependent) -->
  <script src="js/ui/dom-utils.js"></script>
  <script src="js/ui/bands-ui.js"></script>
  <script src="js/ui/charges-ui.js"></script>
  <script src="js/ui/charts.js"></script>
  <script src="js/ui/results.js"></script>
  <script src="js/ui/config.js"></script>

  <!-- App initialization -->
  <script src="js/app.js"></script>
</body>
</html>
